---
id: '11'
lezione: "20231102"
title: "Memory error exploits - Smashing the stack"
author: "Sam. Kaluwaduge"
keywords: 
---

<style>
    strong{
        background-color:#faf43e;
        color: black;
        padding:0.1rem 0.2rem;
        border-radius:5px;
    }
</style>

# Esercizi
~~~c
~~~

compila il prog

inserire una shellcode

//bin/sh perchè vabene per tutto 
uso doppoio slash per crearmi fine della stringa per questo dopo uso shr rbx, 0x8 sifto di 8 bit a destra
questo perchè quando il programma gets or scanf legge input smette di leggere quando trova \00 \0a quindi l'input che mnadiamo cn shellcode nn può contentere \00 \0a
bisogna prendere solo la parte .text la sezione codic
objcopy -O binary --only

strings code.text - stampa la parte leggibile

trovare una stringa che porta a /bin/shell dice che è prob un shellcode

shellstorm per trovare shellcode

https://shell-storm.org/shellcode/index.html

come capisco cosa mettere dentro RA lo faccio trovo con gdb
(usare gdb con gef)
break main 
run
c per continue fino al nexxt break

come capsico che sn arrivato a RA? sicuramente più di 80 byte
 uso una stringa con xxxx yyyy che cambiano ogni 4 byte per capire dove sono dentro lo stack.
 disas main # disassebma il main

 la funzione prima di main è libc start main è lui che fa call della main


 break main+59 # main + 59 righe in assembly # metto breakpoint al ret
 run < payload avvia con il payload il file

 cosi vedo rsp che punta a 

 per trovare inidirizzo di variabile buf scriviamo qualcosa dentro buf e contrlliamo lo stack

 x/64x $rsp-64 


 usim istruzioni nop per mettere un offset dentro il buf (per eivtare di fare conti con indirizzi)

 -z execstack per mette di avviare il codice dallo stack

 set follow-exec-mode new # permette di avviare altri programmi da questo programma
 cosi fa debug anche del nuovo prog

 ghidra per decompilare un programma compilato

checksec # per vedere a quali attacchi è vulnerabile

secondo ex con buf molto piccolo
